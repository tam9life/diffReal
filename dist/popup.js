(()=>{"use strict";const e={minWidth:512,minHeight:512,realThreshold:.5,nsfwThreshold:.5,autoAnalyze:!0,showOverlay:!0};let t={...e};function n(){const e=document.getElementById("minWidth"),n=document.getElementById("minHeight"),s=document.getElementById("realThreshold"),a=document.getElementById("nsfwThreshold"),o=document.getElementById("autoAnalyze"),l=document.getElementById("showOverlay");e&&(e.value=String(t.minWidth)),n&&(n.value=String(t.minHeight)),s&&(s.value=String(t.realThreshold)),a&&(a.value=String(t.nsfwThreshold)),o&&(o.checked=t.autoAnalyze),l&&(l.checked=t.showOverlay),d("realThreshold",t.realThreshold),d("nsfwThreshold",t.nsfwThreshold)}function d(e,t){const n=document.getElementById(`${e}Value`);n&&(n.textContent=t.toFixed(2))}function s(e){const t=document.getElementById("clipStatus"),n=document.getElementById("nsfwStatus"),d=document.getElementById("gpuStatus");t&&(t.className=`popup-status-badge ${e.clip}`,t.textContent="loading"===e.clip?`Loading ${e.clipProgress}%`:"ready"===e.clip?"Ready":"Error"),n&&(n.className=`popup-status-badge ${e.nsfw}`,n.textContent="loading"===e.nsfw?`Loading ${e.nsfwProgress}%`:"ready"===e.nsfw?"Ready":"Error"),d&&(d.className="popup-status-badge ready",d.textContent=e.gpuBackend.toUpperCase())}async function a(e){t={...t,...e},await chrome.runtime.sendMessage({type:"UPDATE_SETTINGS",payload:e})}chrome.runtime.onMessage.addListener(e=>{"MODEL_PROGRESS"!==e.type&&"MODEL_STATUS"!==e.type||s(e.payload)}),document.addEventListener("DOMContentLoaded",async function(){t=await chrome.runtime.sendMessage({type:"GET_SETTINGS"})||t,n();const o=await chrome.runtime.sendMessage({type:"GET_MODEL_STATUS"});o&&s(o),function(){const s=document.getElementById("togglePanel");s?.addEventListener("click",async()=>{await chrome.runtime.sendMessage({type:"TOGGLE_PANEL"}),window.close()});const o=document.getElementById("minWidth"),l=document.getElementById("minHeight");o?.addEventListener("change",()=>{a({minWidth:parseInt(o.value,10)||512})}),l?.addEventListener("change",()=>{a({minHeight:parseInt(l.value,10)||512})});const c=document.getElementById("realThreshold");c?.addEventListener("input",()=>{const e=parseFloat(c.value);d("realThreshold",e),a({realThreshold:e})});const r=document.getElementById("nsfwThreshold");r?.addEventListener("input",()=>{const e=parseFloat(r.value);d("nsfwThreshold",e),a({nsfwThreshold:e})});const i=document.getElementById("autoAnalyze");i?.addEventListener("change",()=>{a({autoAnalyze:i.checked})});const h=document.getElementById("showOverlay");h?.addEventListener("change",()=>{a({showOverlay:h.checked})});const m=document.getElementById("resetSettings");m?.addEventListener("click",async d=>{d.preventDefault(),t={...e},await a(t),n()})}()})})();