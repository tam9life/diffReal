(()=>{"use strict";const e={minWidth:200,minHeight:200,realThreshold:.5,nsfwThreshold:.5,autoAnalyze:!0,showOverlay:!0};let t={...e};function n(){const e=document.getElementById("minWidth"),n=document.getElementById("minHeight"),d=document.getElementById("realThreshold"),s=document.getElementById("nsfwThreshold"),o=document.getElementById("autoAnalyze"),l=document.getElementById("showOverlay");e&&(e.value=String(t.minWidth)),n&&(n.value=String(t.minHeight)),d&&(d.value=String(t.realThreshold)),s&&(s.value=String(t.nsfwThreshold)),o&&(o.checked=t.autoAnalyze),l&&(l.checked=t.showOverlay),a("realThreshold",t.realThreshold),a("nsfwThreshold",t.nsfwThreshold)}function a(e,t){const n=document.getElementById(`${e}Value`);n&&(n.textContent=t.toFixed(2))}function d(e){const t=document.getElementById("clipStatus"),n=document.getElementById("nsfwStatus"),a=document.getElementById("gpuStatus");t&&(t.className=`popup-status-badge ${e.clip}`,t.textContent="loading"===e.clip?`Loading ${e.clipProgress}%`:"ready"===e.clip?"Ready":"Error"),n&&(n.className=`popup-status-badge ${e.nsfw}`,n.textContent="loading"===e.nsfw?`Loading ${e.nsfwProgress}%`:"ready"===e.nsfw?"Ready":"Error"),a&&(a.className="popup-status-badge ready",a.textContent=e.gpuBackend.toUpperCase())}async function s(e){t={...t,...e},await chrome.runtime.sendMessage({type:"UPDATE_SETTINGS",payload:e})}chrome.runtime.onMessage.addListener(e=>{"MODEL_PROGRESS"!==e.type&&"MODEL_STATUS"!==e.type||d(e.payload)}),document.addEventListener("DOMContentLoaded",async function(){t=await chrome.runtime.sendMessage({type:"GET_SETTINGS"})||t,n();const o=await chrome.runtime.sendMessage({type:"GET_MODEL_STATUS"});o&&d(o),function(){const d=document.getElementById("togglePanel");d?.addEventListener("click",async()=>{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});e?.id&&await chrome.tabs.sendMessage(e.id,{type:"TOGGLE_PANEL"}),window.close()});const o=document.getElementById("minWidth"),l=document.getElementById("minHeight");o?.addEventListener("change",()=>{s({minWidth:parseInt(o.value,10)||512})}),l?.addEventListener("change",()=>{s({minHeight:parseInt(l.value,10)||512})});const c=document.getElementById("realThreshold");c?.addEventListener("input",()=>{const e=parseFloat(c.value);a("realThreshold",e),s({realThreshold:e})});const r=document.getElementById("nsfwThreshold");r?.addEventListener("input",()=>{const e=parseFloat(r.value);a("nsfwThreshold",e),s({nsfwThreshold:e})});const i=document.getElementById("autoAnalyze");i?.addEventListener("change",()=>{s({autoAnalyze:i.checked})});const h=document.getElementById("showOverlay");h?.addEventListener("change",()=>{s({showOverlay:h.checked})});const m=document.getElementById("resetSettings");m?.addEventListener("click",async a=>{a.preventDefault(),t={...e},await s(t),n()})}()})})();